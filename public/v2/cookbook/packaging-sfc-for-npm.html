


<!DOCTYPE html>
<html lang="ja">
  <head><meta name="generator" content="Hexo 3.8.0">
    <title>Vue コンポーネントを npm パッケージ化する — Vue.js</title>
    <meta charset="utf-8">
    <meta name="description" content="Vue.js - The Progressive JavaScript Framework">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="alternate" hreflang="x-default" href="https://vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="zh" href="https://cn.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="ja" href="https://jp.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="ru" href="https://ru.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="ko" href="https://kr.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="pt-BR" href="https://br.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="fr" href="https://fr.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">
    <link rel="alternate" hreflang="es" href="https://es.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Vue コンポーネントを npm パッケージ化する — Vue.js">
    <meta property="og:description" content="Vue.js - The Progressive JavaScript Framework">
    <meta property="og:image" content="https://jp.vuejs.org//images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Vue コンポーネントを npm パッケージ化する — Vue.js">
    <meta name="twitter:description" content="Vue.js - The Progressive JavaScript Framework">
    <meta name="twitter:image" content="https://jp.vuejs.org/images/logo.png">

    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
    <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
    <link rel="icon" href="/images/logo.png" type="image/png">

    <meta name="msapplication-TileColor" content="#4fc08d">
    <meta name="theme-color" content="#4fc08d">

    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="/manifest.json">

    <link href="https://fonts.googleapis.com" rel="preconnect" crossorigin="">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="">
    <link href="https://maxcdn.bootstrapcdn.com" rel="preconnect" crossorigin="">

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dosis:500&text=Vue.js&display=swap" rel="stylesheet">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->
    <script src="/js/vue.js"></script>

    

    <script>
      Vue.config.productionTip = false
      window.PAGE_TYPE = "cookbook"
    </script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46852172-1', 'jp.vuejs.org');
      ga('send', 'pageview');
    </script>

    <!-- vimeo analytics -->
    <script type="text/javascript" defer="defer" src="https://extend.vimeocdn.com/ga/72160148.js"></script>
  </head>
  <body class="docs">
    <div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>
    <header id="header">
  <a id="logo" href="/">
    <img src="/images/logo.png" alt="vue logo">
    <span>Vue.js</span>
  </a>
  <ul id="nav">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input" aria-label="検索">
  </form>
</li>
<li class="nav-dropdown-container learn">
  <a class="nav-link current">学ぶ</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>ドキュメント</h4></li>
    <li>
      <ul>
        <li><a href="/v2/guide/" class="nav-link">ガイド</a></li>
        <li><a href="/v2/api/" class="nav-link">API</a></li>
        <li><a href="/v2/style-guide/" class="nav-link">スタイルガイド</a></li>
        <li><a href="/v2/examples/" class="nav-link">例</a></li>
        <li><a href="/v2/cookbook/" class="nav-link current">クックブック</a></li>
      </ul>
    </li>
    <li><h4>ビデオコース</h4></li>
    <li>
      <ul>
        <li>
          <a href="https://www.vuemastery.com/courses/" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue Mastery
          </a>
        </li>
        <li>
          <a href="https://vueschool.io/?friend=vuejs&utm_source=Vuejs.org&utm_medium=Link&utm_content=Navbar%20Dropdown" class="nav-link" target="_blank" rel="sponsored noopener">
            Vue School
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">エコシステム</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><h4>ヘルプ</h4></li>
    <li><ul>
      <li><a href="https://forum.vuejs.org/" class="nav-link" target="_blank" rel="noopener">フォーラム</a></li>
      <li><a href="https://chat.vuejs.org/" class="nav-link" target="_blank" rel="noopener">チャット(公式)</a></li>
      <li><a href="https://vuejs-jp-slackin.herokuapp.com" class="nav-link" target="_blank" rel="noopener">チャット(日本向け)</a></li>
      <li><a href="https://events.vuejs.org/meetups/" class="nav-link" target="_blank" rel="noopener">ミートアップ</a></li>
    </ul></li>
    <li><h4>開発ツール</h4></li>
    <li>
      <ul>
        <li><a href="https://github.com/vuejs/vue-devtools" class="nav-link" target="_blank" rel="noopener">Devtools</a></li>
        <li><a href="https://cli.vuejs.org/" class="nav-link" target="_blank" rel="noopener">Vue CLI</a></li>
        <li><a href="https://vue-loader.vuejs.org" class="nav-link" target="_blank" rel="noopener">Vue Loader</a></li>
      </ul>
    </li>
    <li><h4>コアライブラリ</h4></li>
    <li><ul>
      <li><a href="https://router.vuejs.org/ja/" class="nav-link" target="_blank" rel="noopener">Vue Router</a></li>
      <li><a href="https://vuex.vuejs.org/ja/" class="nav-link" target="_blank" rel="noopener">Vuex</a></li>
      <li><a href="https://ssr.vuejs.org/ja/" class="nav-link" target="_blank" rel="noopener">Vue Server Renderer</a></li>
    </ul></li>
    <li><h4>ニュース</h4></li>
    <li><ul>
      <li><a href="https://news.vuejs.org" class="nav-link" target="_blank" rel="noopener">ウィークリーニュース</a></li>
      <li><a href="https://github.com/vuejs/vue/projects/6" class="nav-link" target="_blank" rel="noopener">ロードマップ</a></li>
      <li><a href="https://events.vuejs.org/" class="nav-link" target="_blank" rel="noopener">イベント</a></li>
      <li><a href="https://twitter.com/vuejs" class="nav-link" target="_blank" rel="noopener">Twitter</a></li>
      <li><a href="https://medium.com/the-vue-point" class="nav-link" target="_blank" rel="noopener">ブログ(英語)</a></li>
      <li><a href="/blog/" class="nav-link" target="_blank" rel="noopener">ブログ(日本語訳)</a></li>
      <li><a href="https://vuejobs.com/?ref=vuejs" class="nav-link" target="_blank" rel="noopener">ジョブ(海外)</a></li>
      <li><a href="https://dev.to/t/vue" class="nav-link" target="_blank" rel="noopener">DEV コミュニティ</a></li>
    </ul></li>
  </ul>
</li>

<li>
  <a href="/v2/guide/team.html" class="nav-link team">チーム</a>
</li>
<li>
  <a href="/contribution/" class="nav-link">貢献</a>
</li>
<li class="nav-dropdown-container resources">
  <a href="#" class="nav-link">リソース</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/resources/partners.html" class="nav-link">パートナー</a></li>
    <li><a href="/resources/themes.html" class="nav-link">テーマ</a></li>
    <li><a href="https://github.com/vuejs/awesome-vue" class="nav-link" target="_blank" rel="noopener">Awesome Vue</a></li>
    <li><a href="https://awesomejs.dev/for/vue/" class="nav-link" target="_blank" rel="noopener">Browse packages for Vue</a></li>
  </ul>
</li>

<!-- <li>
  <a href="/partners" class="nav-link ">Partners</a>
</li> -->
<li class="nav-dropdown-container support-vue">
  <a href="/support-vuejs/" class="nav-link">Vue を支援する</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="/support-vuejs/#1回きりの支援" class="nav-link">1回きりの支援</a></li>
    <li><a href="/support-vuejs/#継続的な支援" class="nav-link">継続的な支援</a></li>
    <li><a href="https://vue.threadless.com" target="_blank" rel="noopener" class="nav-link">Tシャツ ショップ</a></li>
  </ul>
</li>

<li class="nav-dropdown-container language">
  <a class="nav-link">言語</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">English</a></li>
    <li><a href="https://cn.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">中文</a></li>
    <li><a href="https://ru.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">Русский</a></li>
    <li><a href="https://kr.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">한국어</a></li>
    <li><a href="https://br.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">Português</a></li>
    <li><a href="https://fr.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">Français</a></li>
    <li><a href="https://vi.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">Tiếng Việt</a></li>
    <li><a href="https://es.vuejs.org/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">Español</a></li>
    <li><a href="https://docs.vuejs.id/v2/cookbook/packaging-sfc-for-npm.html" class="nav-link">Bahasa Indonesia</a></li>
  </ul>
</li>


  </ul>
</header>

    
      <div id="main" class="fix-sidebar">
        
  

<div class="sidebar">
  <div class="sidebar-inner">
    
    <div class="list">
      <div id="sidebar-sponsors-special">
  <div class="main-sponsor">
    <span>スペシャルスポンサー</span>
    <div>
    <a href="https://autocode.com" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/autocode.svg" alt="Autocode">
    </a>
    </div>
  </div>
</div>

<div id="sidebar-sponsors-platinum-left">
  <div class="main-sponsor">
    <span>プラチナスポンサー</span>
    <div>
    <a href="https://vehikl.com/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/vehikl.png" alt="Vehikl">
    </a>
    <a href="https://retool.com/?utm_source=sponsor&utm_campaign=vue" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/retool.png" alt="Retool">
    </a>
    <a href="https://passionatepeople.io/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/passionate_people.png" alt="Passionate People">
    </a>
    <a href="https://www.storyblok.com" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/storyblok.png" alt="Storyblok">
    </a>
    </div>
  </div>
  <a class="become-backer" href="/support-vuejs">
    スポンサーになる
  </a>
</div>



      
        <h2>
          
          クックブック<sup class="beta">beta</sup>
          
        </h2>
        <ul class="menu-root">
  
    
    
    <li>
      <a href="/v2/cookbook/index.html" class="sidebar-link">はじめに</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/adding-instance-properties.html" class="sidebar-link">インスタンスプロパティの追加</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/form-validation.html" class="sidebar-link">フォームのバリデーション</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/editable-svg-icons.html" class="sidebar-link">編集可能な SVG アイコンシステム</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/serverless-blog.html" class="sidebar-link">CMS によるブログの作成</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/unit-testing-vue-components.html" class="sidebar-link">Vue コンポーネントの単体テスト</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/creating-custom-scroll-directives.html" class="sidebar-link">カスタムスクロールディレクティブの作成</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/debugging-in-vscode.html" class="sidebar-link">VS Code によるデバッグ</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/using-axios-to-consume-apis.html" class="sidebar-link">axios を利用した API の使用</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/avoiding-memory-leaks.html" class="sidebar-link">メモリリークを回避する</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/client-side-storage.html" class="sidebar-link">クライアントサイドストレージ</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/packaging-sfc-for-npm.html" class="sidebar-link current">Vue コンポーネントを npm パッケージ化する</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/dockerize-vuejs-app.html" class="sidebar-link">Vue.js アプリケーションを Docker 化する</a>
    </li>
  
    
    
    <li>
      <a href="/v2/cookbook/practical-use-of-scoped-slots.html" class="sidebar-link">Practical use of scoped slots with GoogleMaps</a>
    </li>
  
</ul>

      
    </div>
  </div>
</div>

<div id="sidebar-sponsors-platinum-right">
  <div class="main-sponsor">
    <span>プラチナスポンサー</span>
    <div>
    <a href="https://vehikl.com/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/vehikl.png" alt="Vehikl">
    </a>
    <a href="https://retool.com/?utm_source=sponsor&utm_campaign=vue" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/retool.png" alt="Retool">
    </a>
    <a href="https://passionatepeople.io/" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/passionate_people.png" alt="Passionate People">
    </a>
    <a href="https://www.storyblok.com" target="_blank" rel="sponsored noopener" class="logo">
      <img src="/images/storyblok.png" alt="Storyblok">
    </a>
    </div>
  </div>
  <a class="become-backer" href="/support-vuejs">
    スポンサーになる
  </a>
</div>




<div class="content cookbook with-sidebar ">
  
    
      
<div id="ad">
  <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYIK2QU&placement=vuejsorg" id="_carbonads_js">
  </script>
</div>


    
  
  
    <h1>Vue コンポーネントを npm パッケージ化する</h1>
  
  <p class="updated">最終更新日: 2020年4月25日</p>
  
  
    <h2 id="基本例"><a href="#基本例" class="headerlink" title="基本例"></a>基本例</h2><p>元々 Vue コンポーネントは再利用される物です。再利用はそのコンポーネントを1つのアプリケーション内でのみ利用する場合は簡単に行えます。しかし一度書いたコンポーネントを複数のサイトやアプリケーションで利用するにはどうしたら良いでしょう。おそらく最も簡単な解決策は npm を利用する事です。</p>
<p>npm を経由して共有できるようにコンポーネントをパッケージ化する事で、成熟したウェブ・アプリケーションにおけるビルドのプロセス内にコンポーネントを組み込むことができます。:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> MyComponent <span class="hljs-keyword">from</span> <span class="hljs-string">'my-component'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
  <span class="hljs-attr">components</span>: &#123;
    MyComponent,
  &#125;,
  <span class="hljs-comment">// コンポーネントの残りの箇所</span>
&#125;</code></pre>
<p>直接ブラウザ内で <code>&lt;script&gt;</code> タグを用いて利用する事もできます:</p>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/vue"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/my-component"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
...
<span class="hljs-tag">&lt;<span class="hljs-name">my-component</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">my-component</span>&gt;</span>
...</code></pre>
<p>この手順を踏む事でコンポーネント周りをコピー&amp;ペーストしなくて済むだけでなく、Vue コミュニティに還元する事にもなります！</p>
<h2 id="vue-ファイルを直接共有するだけでは駄目なのか"><a href="#vue-ファイルを直接共有するだけでは駄目なのか" class="headerlink" title=".vue ファイルを直接共有するだけでは駄目なのか"></a><code>.vue</code> ファイルを直接共有するだけでは駄目なのか</h2><p>Vue は既にコンポーネントを1つのファイルとして記述する事を許容しています。単一ファイルコンポーネントは元から1つのファイルのため、次のような疑問を抱くかもしれません:</p>
<blockquote>
<p>「なぜみんなは <code>.vue</code> ファイルを直接使ってくれないんだろう？これがコンポーネントを共有する最も簡単な方法でしょう？」</p>
</blockquote>
<p>その考えは正しく、<code>.vue</code> ファイルは直接共有する事ができ、Vue コンパイラを含んで <a href="https://jp.vuejs.org/v2/guide/installation.html#さまざまなビルドについて">ビルドされた Vue</a> を利用する人は誰でもそのファイルを直ちに利用できます。また、サーバサイドレンダリングのためのビルドにおいては文字列の連結を最適化のため用いるので、その状況においては <code>.vue</code> ファイルの利用が適しています（詳細は <a href="#サーバサイドレンダリングでの利用">npm を用いたコンポーネントのパッケージ化 &gt; サーバサイドレンダリングでの利用</a> を参照）。しかしながら、その方針ではコンポーネントをブラウザで <code>&lt;script&gt;</code> タグを通して直接利用したい人、ランタイム限定ビルドや、 <code>.vue</code> ファイルをどのように扱うかが示されていないビルドを用いる人を排除する事になります。</p>
<p>npm を用いて配布できるように単一ファイルコンポーネントを適切にパッケージ化する事でどこでも利用可能な物としてコンポーネントを共有できるのです！</p>
<h2 id="npm-を用いたコンポーネントのパッケージ化"><a href="#npm-を用いたコンポーネントのパッケージ化" class="headerlink" title="npm を用いたコンポーネントのパッケージ化"></a>npm を用いたコンポーネントのパッケージ化</h2><p>このセクションを理解するため、以下のファイル構造を想定して下さい:</p>
<pre><code class="hljs undefined">package.json
build/
   rollup.config.js
src/
   wrapper.js
   my-component.vue
dist/</code></pre>
<p class="tip">本ドキュメント全体を通して、上記の package.json が参照されます。以下の例で用いられるこのファイルは手動で生成され、じきに行う議論や課題に必要とされる最小限の設定を含んでいます。各自が利用している package.json ファイルはここに示されるよりも多くの設定を保持している可能性があります。</p>

<h3 id="ブラウザやビルドプロセスに対して提供するバージョンを-npm-にどのように定義するか"><a href="#ブラウザやビルドプロセスに対して提供するバージョンを-npm-にどのように定義するか" class="headerlink" title="ブラウザやビルドプロセスに対して提供するバージョンを npm にどのように定義するか"></a>ブラウザやビルドプロセスに対して提供するバージョンを npm にどのように定義するか</h3><p>npm が用いる package.json ファイルにおいて本当は1つのバージョン (<code>main</code>) が必要なのですが、それは何も、作成の制限が存在するという事ではありません。ここでは最も一般的な利用ケースとして 2 つの追加バージョン (<code>module</code> および <code>unpkg</code>) を定義し、 <code>browser</code> フィールドを用いて直接 <code>.vue</code> ファイルへのアクセスを提供するとします。例示した package.json は以下のようになります:</p>
<pre><code class="hljs json">&#123;
  "name": "my-component",
  "version": "1.2.3",
  "main": "dist/my-component.umd.js",
  "module": "dist/my-component.esm.js",
  "unpkg": "dist/my-component.min.js",
  "browser": &#123;
    "./sfc": "src/my-component.vue"
  &#125;,
  ...
&#125;</code></pre>
<p>webpack バージョン 2 以降や、 Rollup あるいは他のモダンなビルドツールを用いれば、 <code>module</code> ビルドを解釈してくれます。レガシーなアプリケーションは <code>main</code> ビルドを使い、 <code>unpkg</code> ビルドはブラウザで直接利用されます。実際に、誰かがあなたのモジュールの URL を入れれば彼らのサービス内では <a href="https://unpkg.com" target="_blank" rel="noopener">unpkg</a> の CDN がこのビルドを自動的に利用します。</p>
<h3 id="サーバサイドレンダリングでの利用"><a href="#サーバサイドレンダリングでの利用" class="headerlink" title="サーバサイドレンダリングでの利用"></a>サーバサイドレンダリングでの利用</h3><p>興味深い点に気づかれたかもしれません - ブラウザは <code>browser</code> バージョンを利用する訳ではないのです。これはこのフィールドが実は利用者側で各自のパッケージを作成する際に作成者が <a href="https://github.com/defunctzombie/package-browser-field-spec#spec" target="_blank" rel="noopener">モジュールバンドラを補助する</a> ために有るからです。少し創造性を持たせて、このフィールドは <code>.vue</code> ファイル自体へエイリアスを作成する事を許容します。以下の例のように記述できます:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> MyComponent <span class="hljs-keyword">from</span> <span class="hljs-string">'my-component/sfc'</span>; <span class="hljs-comment">// '/sfc' に注意</span></code></pre>
<p>互換性の有るモジュールバンドラは package.json 内の <code>browser</code> の定義を参照して <code>my-component/sfc</code> に対するリクエストを <code>my-component/src/my-component.vue</code> へと変換し、結果として元の <code>.vue</code> ファイルが代わりに利用されます。現在ではサーバサイドレンダリングの処理においてパフォーマンス向上の為に必要な文字列連結時の最適化を利用できます。</p>
<p class="tip">注意: <code>.vue</code> 形式のコンポーネントを直接利用する場合、<code>script</code> や <code>style</code> タグが必要とするあらゆるプリ・プロセス処理に注意して下さい。これらの依存性は利用者に引き継がれます。可能な限り物事を簡単にしておくため「プレーンな」単一ファイルコンポーネントを提供する事を心がけてください。</p>

<h3 id="どのようにしてコンポーネントのバージョンを複数作成するのか"><a href="#どのようにしてコンポーネントのバージョンを複数作成するのか" class="headerlink" title="どのようにしてコンポーネントのバージョンを複数作成するのか"></a>どのようにしてコンポーネントのバージョンを複数作成するのか</h3><p>モジュールを複数回作成する必要は有りません。少しの時間で完了する、1つの手順でモジュールの 3 つのバージョン全てを用意する事が可能です。ここの例では設定を最小限にするため <a href="https://rollupjs.org" target="_blank" rel="noopener">Rollup</a> を利用しますが、他のビルドツールでも同様の設定ができます - この決定に関わる詳細は <a href="https://medium.com/webpack/webpack-and-rollup-the-same-but-different-a41ad427058c" target="_blank" rel="noopener">こちら</a> から参照できます。 package.json の <code>scripts</code> セクションはビルド対象毎に行う処理、加えてそれら全てをまとめて処理する、より一般的な <code>build</code> スクリプトによって更新されます。例となる package.json ファイルは以下のようになります:</p>
<pre><code class="hljs json">&#123;
  "name": "my-component",
  "version": "1.2.3",
  "main": "dist/my-component.umd.js",
  "module": "dist/my-component.esm.js",
  "unpkg": "dist/my-component.min.js",
  "browser": &#123;
    "./sfc": "src/my-component.vue"
  &#125;,
  "scripts": &#123;
    "build": "npm run build:umd &amp; npm run build:es &amp; npm run build:unpkg",
    "build:umd": "rollup --config build/rollup.config.js --format umd --file dist/my-component.umd.js",
    "build:es": "rollup --config build/rollup.config.js --format es --file dist/my-component.esm.js",
    "build:unpkg": "rollup --config build/rollup.config.js --format iife --file dist/my-component.min.js"
  &#125;,
  "devDependencies": &#123;
    "rollup": "^1.17.0",
    "@rollup/plugin-buble": "^0.21.3",
    "@rollup/plugin-commonjs": "^11.1.0",
    "rollup-plugin-vue": "^5.0.1",
    "vue": "^2.6.10",
    "vue-template-compiler": "^2.6.10"
    ...
  &#125;,
  ...
&#125;</code></pre>
<p class="tip">もし既に package.json ファイルを利用している場合、上記よりも多くの内容を含んでいるであろう事を忘れないでください。これは単に初期段階を示しただけです。また、 devDependencies 内に記述された(それぞれのバージョンでなく)<i>パッケージ</i>は先述した 3 つの異なるビルド (umd、 es および unpkg) を rollup が作成するために最低限必要な物になっています。より新しいバージョンが利用できるようになれば、必要に応じて更新する必要が有ります。</p>

<p>package.json に加える変更は完了しました。続いて、実際に単一ファイルコンポーネントをエクスポートおよび自動インストールするための小さなラッパーを用意し、必要な Rollup の設定を加えて準備します。</p>
<h3 id="パッケージ化されたコンポーネントはどのようになったか"><a href="#パッケージ化されたコンポーネントはどのようになったか" class="headerlink" title="パッケージ化されたコンポーネントはどのようになったか"></a>パッケージ化されたコンポーネントはどのようになったか</h3><p>コンポーネントがどのように利用されるかに応じて、<a href="https://medium.freecodecamp.org/javascript-modules-a-beginner-s-guide-783f7d7a5fcc#c33a" target="_blank" rel="noopener">CommonJS/UMD</a> の javascript モジュール、 <a href="https://medium.freecodecamp.org/javascript-modules-a-beginner-s-guide-783f7d7a5fcc#4f5e" target="_blank" rel="noopener">ES6 javascript</a> のモジュール、あるいは <code>&lt;script&gt;</code> タグでの利用に対応した形式のいずれかの形で利用可能とする必要が有り、そのコンポーネントは <code>Vue.use(...)</code> を通して Vue に自動的に読み込まれてページ上で即座に利用できるようになります。この処理はモジュールのエクスポートおよび自動インストールを引き受ける単純な wrapper.js ファイルによって行えます。その wrapper は、全体を記述すると、以下のようになります:</p>
<pre><code class="hljs js"><span class="hljs-comment">// vue コンポーネントのインポート</span>
<span class="hljs-keyword">import</span> component <span class="hljs-keyword">from</span> <span class="hljs-string">'./my-component.vue'</span>;

<span class="hljs-comment">// Vue.use() によって実行される install 関数を定義</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">install</span>(<span class="hljs-params">Vue</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (install.installed) <span class="hljs-keyword">return</span>;
	install.installed = <span class="hljs-literal">true</span>;
	Vue.component(<span class="hljs-string">'MyComponent'</span>, component);
&#125;

<span class="hljs-comment">// Vue.use() のためのモジュール定義を作成</span>
<span class="hljs-comment">// Create module definition for Vue.use()</span>
<span class="hljs-keyword">const</span> plugin = &#123;
	install,
&#125;;

<span class="hljs-comment">// vue が見つかった場合に自動インストールする (ブラウザで &lt;script&gt; タグを用いた場合等)</span>
<span class="hljs-keyword">let</span> GlobalVue = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">'undefined'</span>) &#123;
	GlobalVue = <span class="hljs-built_in">window</span>.Vue;
&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> global !== <span class="hljs-string">'undefined'</span>) &#123;
	GlobalVue = global.Vue;
&#125;
<span class="hljs-keyword">if</span> (GlobalVue) &#123;
	GlobalVue.use(plugin);
&#125;

<span class="hljs-comment">// (npm/webpack 等で) モジュールとして利用させるためコンポーネントを export する</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component;</code></pre>
<p>最初の行では単一ファイルコンポーネントを直接読み込み、最後の行ではその内容を変更しないでエクスポートしている事に気づくでしょう。コード内のコメントで示されるように、このラッパーは Vue のための <code>install</code> 関数を提供し、続いて Vue を検知してコンポーネントを自動的にインストールしようと試みています。作業は9割方終わりました、最後まで一気に進みましょう。</p>
<h3 id="Rollup-ビルドをどのように設定するか"><a href="#Rollup-ビルドをどのように設定するか" class="headerlink" title="Rollup ビルドをどのように設定するか"></a>Rollup ビルドをどのように設定するか</h3><p>package.json の <code>script</code> セクションの準備と単一ファイルコンポーネント用のラッパーが用意できれば、残りは Rollup が適切に設定されていることを確認するだけです。幸いにも、この操作はほんの 16 行の rollup.config.js ファイルによって行えます:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> commonjs <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-commonjs'</span>; <span class="hljs-comment">// CommonJS モジュールを ES6 に変換</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'rollup-plugin-vue'</span>; <span class="hljs-comment">// .vue 単一ファイルコンポーネントを取得</span>
<span class="hljs-keyword">import</span> buble <span class="hljs-keyword">from</span> <span class="hljs-string">'@rollup/plugin-buble'</span>; <span class="hljs-comment">// 適切にブラウザをサポートするトランスパイラおよびポリフィル</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
    <span class="hljs-attr">input</span>: <span class="hljs-string">'src/wrapper.js'</span>, <span class="hljs-comment">// Path relative to package.json</span>
    output: &#123;
        <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponent'</span>,
        <span class="hljs-attr">exports</span>: <span class="hljs-string">'named'</span>,
    &#125;,
    <span class="hljs-attr">plugins</span>: [
        commonjs(),
        vue(&#123;
            <span class="hljs-attr">css</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// css を &lt;style&gt; タグとして注入</span>
            compileTemplate: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 明示的にテンプレートを描画関数に変換</span>
        &#125;),
        buble(), <span class="hljs-comment">// ES5 へトランスパイルする</span>
    ],
&#125;;</code></pre>
<p>ここに例示した設定ファイルは npm のために単一ファイルコンポーネントをパッケージ化する最小限の設定となっています。CSS プリプロセッサを利用して、 CSS を別のファイルとして取得したり、JS の出力を難読化したりするカスタマイズを加える余地が有ります。</p>
<p>また、ここでコンポーネントに付与された <code>name</code> の値に注目すべきです。コンポーネントに付与されるのはパスカルケースの名称で、これはここまでの手順で利用されてきたケバブケースの名称に対応していなければなりません。</p>
<h3 id="この手順は現在の開発工程に取って代わるものか"><a href="#この手順は現在の開発工程に取って代わるものか" class="headerlink" title="この手順は現在の開発工程に取って代わるものか"></a>この手順は現在の開発工程に取って代わるものか</h3><p>このページの設定は現在使っている開発工程を置き換えるものでは有りません。もし現在 webpack を用いたホット・モジュール・リロードを行う環境を利用しているのならば、その環境を使い続けるべきです。もし何もない状態ならば、ホット・モジュール・リロードの設定全体を自由に扱える、 <a href="https://github.com/vuejs/vue-cli/" target="_blank" rel="noopener">Vue CLI 3</a> を使って下さい。</p>
<pre><code class="hljs bash">vue serve --open src/my-component.vue</code></pre>
<p>言い換えると、各自の好みに合った物を開発環境で使ってください。この手順で大まかに示されているのは完全な開発プロセスというよりは「最後の仕上げ」になります。</p>
<h2 id="どのような場合にこのパターンの利用を避けるべきか"><a href="#どのような場合にこのパターンの利用を避けるべきか" class="headerlink" title="どのような場合にこのパターンの利用を避けるべきか"></a>どのような場合にこのパターンの利用を避けるべきか</h2><p>ここで示した方法で単一ファイルコンポーネントをパッケージ化するのは特定の状況では良いアイデアとはならないかもしれません。この手順はコンポーネント自体がどのように書かれるかという点については深く掘り下げませんでした。ある種のコンポーネントはディレクティブや追加した機能によって他のライブラリに対して副作用をおよぼすかもしれません。こういった場合には、ここで紹介した手順が必要とする変更が広い範囲に及び過ぎないか評価する必要が有るでしょう。</p>
<p>加えて、自分の単一ファイルコンポーネントが持つかもしれないあらゆる依存性に注意をはらって下さい。例えば、ソートや API を使った操作のためにサードパーティのライブラリが必要となる場合、適切に設定されていないと Rollup はこれらのパッケージを最終的なコードにまとめてしまう可能性が有ります。この手順を使い続けるにあたって、このようなファイルを出力から除外するように Rollup を設定し、利用者に対してはその依存性について周知するためドキュメントを更新する必要が有るかもしれません。</p>
<h2 id="別のパターンについて"><a href="#別のパターンについて" class="headerlink" title="別のパターンについて"></a>別のパターンについて</h2><p>このページが書かれた時点では、Vue CLI 3 はベータ版の状態でした。このバージョンの CLI には、コンポーネントの CommonJS および UMD バージョンを生成するビルドインの <code>library</code> ビルドモードが備わっています。これは状況によっては適していますが、 package.json ファイルが <code>main</code> および <code>unpkg</code> を正しく指定している事は確認する必要が有ります。また、リリースの前に CLI にその機能が付与されるかプラグインを経由しなければ ES6 の <code>module</code> は出力されません。</p>
<h2 id="謝辞"><a href="#謝辞" class="headerlink" title="謝辞"></a>謝辞</h2><p>このページは 2018 年 3 月の VueConf.us で発表された <a href="https://twitter.com/webdevdodge" target="_blank" rel="noopener">Mike Dodge</a> によるライトニング・トークの成果です。彼はこの手順を用いてサンプルの単一ファイルコンポーネントを基本に構築したユーティリティを npm に公開しました。このユーティリティは、 npm を通じて、 <a href="https://www.npmjs.com/package/vue-sfc-rollup" target="_blank" rel="noopener">vue-sfc-rollup</a> からダウンロードできます。さらに <a href="https://github.com/team-innovation/vue-sfc-rollup" target="_blank" rel="noopener">そのリポジトリをクローンして</a> カスタマイズする事もできます。</p>

  
  
  <div class="footer">
      <script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>
<div id="bsa-native"></div>
<script>
_bsa.init('custom', 'CKYD62QM', 'placement:vuejsorg',
  {
    target: '#bsa-native',
    template: '<a class="native-box" href="##statlink##"><div class="native-sponsor">Sponsor</div><div class="native-text"><strong>##company##</strong> — ##description##</div></a>'
  }
);
</script>


    間違いを見つけた、またはドキュメントに貢献したいですか？
    <a href="https://github.com/vuejs/jp.vuejs.org/blob/lang-ja/src/v2/cookbook/packaging-sfc-for-npm.md" rel="noopener" target="_blank">
      GitHub で編集しましょう！
    </a>
    このサイトは
    <a href="https://url.netlify.com/HJ8X2mxP8" rel="noopener" target="_blank">
      Netlify
    </a>
    でホストされています。
  </div>
</div>

      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- main custom script for sidebars, version selects etc. -->
    <script src="/js/css.escape.js"></script>
    <script src="/js/common.js"></script>

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/search.css">
    <script src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script>
    [
      '#search-query-nav',
      '#search-query-sidebar',
      '#search-query-menu'
    ].forEach(function (selector) {
      if (!document.querySelector(selector)) return
      // search index defaults to v2
      var match = window.location.pathname.match(/^\/(v\d+)/)
      var version = match ? match[1] : 'v2'
      docsearch({
      appId: 'BH4D9OD16A',
      apiKey: '0a75952972806d9ad07e387d08e9cc4c',
      indexName: 'vuejs_jp',
      inputSelector: selector,
      algoliaOptions: { facetFilters: ["version:" + version] },
      autocompleteOptions: { hint: false, appendTo: 'body'}
      })
    })
    </script>
  </body>
</html>
